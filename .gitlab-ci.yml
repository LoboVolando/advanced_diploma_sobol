before_script:
  - python3 -m venv venv
  - source ./venv/bin/activate
  - pip install -r requirements.txt

stages:
  - tests
  - deploy

test_job:
  stage: tests
  script:
    - echo "начинаем тестирование приложения"
    - docker-compose -f docker-compose.test.yml stop postgres
    - docker-compose -f docker-compose.test.yml rm -v -f postgres
    - docker-compose -f docker-compose.test.yml up -d postgres
    - PYTHONPATH=./backend/src pytest .
    - echo "тест alles"

deploy_job:
  stage: deploy
  #only: main
  script:
    - echo "Развёртывание приложения"
    - fab deploy
    - echo "Дипломная работа развёрнута"
